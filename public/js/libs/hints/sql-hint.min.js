!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(u){"use strict";var d,g,f,h,b=";",y="AS",C=u.Pos,q=u.cmpPos;function c(t){return"[object Array]"==Object.prototype.toString.call(t)}function p(t){return"string"==typeof t?t:t.text}function v(t,e){return(e=c(e)?{columns:e}:e).text||(e.text=t),e}function A(t){return d[t.toUpperCase()]}function x(t){var e,r={};for(e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}function a(t,e){var r=t.length,e=p(e).substr(0,r);return t.toUpperCase()===e.toUpperCase()}function m(t,e,r,n){if(c(r))for(var o=0;o<r.length;o++)a(e,r[o])&&t.push(n(r[o]));else for(var i in r){var s;!r.hasOwnProperty(i)||a(e,s=(s=r[i])&&!0!==s?s.displayText?{text:s.text,displayText:s.displayText}:s.text:i)&&t.push(n(s))}}function j(t){for(var e=p(t).split("."),r=0;r<e.length;r++)e[r]=h+e[r].replace(new RegExp(h,"g"),h+h)+h;var n=e.join(".");return"string"==typeof t?n:((t=x(t)).text=n,t)}function w(t,e,r,n){for(var o=!1,i=[],s=e.start,a=!0;a;)a="."==e.string.charAt(0),o=o||e.string.charAt(0)==h,s=e.start,i.unshift(function(t){for(var e=(t="."==t.charAt(0)?t.substr(1):t).split(h+h),r=0;r<e.length;r++)e[r]=e[r].replace(new RegExp(h,"g"),"");return e.join(h)}(e.string)),"."==(e=n.getTokenAt(C(t.line,e.start))).string&&(a=!0,e=n.getTokenAt(C(t.line,e.start)));var l=i.join("."),u=(m(r,l,d,function(t){return o?j(t):t}),m(r,l,g,function(t){return o?j(t):t}),l=i.pop(),i.join(".")),f=!1,c=u,p=(A(u)||(u=U(p=u,n))!==p&&(f=!0),A(u));return(p=p&&p.columns?p.columns:p)&&m(r,l,p,function(t){var e=1==f?c:u;return"string"==typeof t?t=e+"."+t:(t=x(t)).text=e+"."+t.text,o?j(t):t}),s}function U(t,e){for(var r=e.doc,n=r.getValue(),o=t.toUpperCase(),i="",s="",a=[],l={start:C(0,0),end:C(e.lastLine(),e.getLineHandle(e.lastLine()).length)},u=n.indexOf(b);-1!=u;)a.push(r.posFromIndex(u)),u=n.indexOf(b,u+1);a.unshift(C(0,0)),a.push(C(e.lastLine(),e.getLineHandle(e.lastLine()).text.length));for(var f=null,c=e.getCursor(),p=0;p<a.length;p++){if((null==f||0<q(c,f))&&q(c,a[p])<=0){l={start:f,end:a[p]};break}f=a[p]}if(l.start)for(var d=r.getRange(l.start,l.end,!1),p=0;p<d.length;p++){for(var g=d[p],h=(m=x=v=h=void 0,g),v=function(t){var e=t.toUpperCase();e===o&&A(i)&&(s=i),e!==y&&(i=t)},x=h.split(/\s+/),m=0;m<x.length;m++)x[m]&&v(x[m].replace(/[`,;]/g,""));if(s)break}return s}u.registerHelper("hint","sql",function(t,e){d=function(t){var e={};if(c(t))for(var r=t.length-1;0<=r;r--){var n=t[r];e[p(n).toUpperCase()]=v(p(n),n)}else if(t)for(var o in t)e[o.toUpperCase()]=v(o,t[o]);return e}(e&&e.tables);var r,n,o,i,s=e&&e.defaultTable,e=e&&e.disableKeywords,a=(g=s&&A(s),a=(a=t).doc.modeOption,f=u.resolveMode(a="sql"===a?"text/x-sql":a).keywords,a=(a=t).doc.modeOption,h=u.resolveMode(a="sql"===a?"text/x-sql":a).identifierQuote||"`",(g=(g=s&&!g?U(s,t):g)||[]).columns&&(g=g.columns),t.getCursor()),s=[],l=t.getTokenAt(a);return l.end>a.ch&&(l.end=a.ch,l.string=l.string.slice(0,a.ch-l.start)),l.string.match(/^[.`"'\w@][\w$#]*$/g)?(o=l.string,r=l.start,n=l.end):(r=n=a.ch,o=""),"."==o.charAt(0)||o.charAt(0)==h?r=w(a,l,s,t):(i=function(t,e){return"object"==typeof t?t.className=e:t={text:t,className:e},t},m(s,o,g,function(t){return i(t,"CodeMirror-hint-table CodeMirror-hint-default-table")}),m(s,o,d,function(t){return i(t,"CodeMirror-hint-table")}),e||m(s,o,f,function(t){return i(t.toUpperCase(),"CodeMirror-hint-keyword")})),{list:s,from:C(a.line,r),to:C(a.line,n)}})});